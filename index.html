<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grow a Garden - Sign Up</title>
<style>
body {
  background-color: black;
  border: 2px solid lightslategray;
  padding: 15px 20px;
  font-family: 'Times New Roman', Times, serif;
  color: gray;
}
h1, h2, p {
  color: gray;
}
button {
  background-color: #2c2c2c;
  border: 2px solid #1a1a1a;
  color: #f5f5f5;
  padding: 15px 20px;
  cursor: pointer;
  border-radius: 8px;
  transition: background-color 0.3s, border-color 0.3s, color 0.3s;
}
button:hover {
  background-color: #3d3d3d;
  border-color: #444;
  color: #ffffff;
}
button:active {
  background-color: #1a1a1a;
  border-color: #555;
  color: #dddddd;
}
.custom-alert-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
}
.custom-alert-box {
  background-color: #111;
  color: #fff;
  padding: 30px 40px;
  border-radius: 15px;
  text-align: center;
  box-shadow: 0 15px 50px rgba(0,0,0,0.8);
  width: 350px;
  border: 4px solid white;
}
.custom-alert-button {
  margin-top: 20px;
  background-color: #f04a4a;
  color: #fff;
  border: none;
  padding: 15px 30px;
  border-radius: 10px;
  cursor: pointer;
  transition: background-color 0.3s;
}
.custom-alert-button:hover {
  background-color: #d03737;
}
body.alert-active .custom-alert-overlay {
  opacity: 1;
  visibility: visible;
}
form {
  max-width: 400px;
  margin: auto;
  display: flex;
  flex-direction: column;
  gap: 15px;
}
input[type="text"],
input[type="email"],
input[type="password"] {
  padding: 10px;
  border-radius: 5px;
  border: 2px solid lightslategray;
  font-family: 'Times New Roman', Times, serif;
  font-size: 16px;
  color: gray;
  background-color: #222;
}
input::placeholder {
  color: gray;
}
</style>
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel" data-presets="react,typescript">
const { useState, useEffect } = React
function CustomAlert({ message, onClose }) {
  useEffect(() => {
    document.body.classList.add('alert-active')
    return () => document.body.classList.remove('alert-active')
  }, [])
  return (
    <div className="custom-alert-overlay" onClick={onClose}>
      <div className="custom-alert-box" onClick={e => e.stopPropagation()}>
        <p>{message}</p>
        <button className="custom-alert-button" onClick={onClose}>OK</button>
      </div>
    </div>
  )
}
function SignUp() {
  const [email, setEmail] = useState('')
  const [username, setUsername] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [captchaToken, setCaptchaToken] = useState('')
  const [alertMessage, setAlertMessage] = useState('')
  useEffect(() => {
    window.turnstile?.render('#captcha', {
      sitekey: '0x4AAAAAABeDBe4pSr2MmYDv',
      callback: (token) => setCaptchaToken(token),
      'error-callback': () => setCaptchaToken(''),
      'expired-callback': () => setCaptchaToken('')
    })
  }, [])
  function validateEmail(e) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)
  }
  function validateUsername(u) {
    return /^[a-zA-Z0-9_]{3,20}$/.test(u)
  }
  function validatePassword(p) {
    return p.length >= 6
  }
  async function handleSubmit(e) {
    e.preventDefault()
    if (!validateEmail(email)) {
      setError('Please enter a valid email.')
      return
    }
    if (!validateUsername(username)) {
      setError('Username must be 3-20 chars and contain only letters, numbers, underscores.')
      return
    }
    if (!validatePassword(password)) {
      setError('Password must be at least 6 characters.')
      return
    }
    if (!captchaToken) {
      setError('Please complete the CAPTCHA.')
      return
    }
    setError('')
    try {
      await new Promise(r => setTimeout(r, 500))
      window.location.href = 'https://grow-a-garden-fanmade.pages.dev'
    } catch {
      setAlertMessage('Sign up failed, try again.')
    }
  }
  return (
    <>
      <h1>Grow a Garden - Sign Up</h1>
      <form onSubmit={handleSubmit} noValidate>
        <input type="email" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} required />
        <input type="text" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} required minLength={3} maxLength={20} pattern="[a-zA-Z0-9_]+" />
        <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} required minLength={6} />
        <div id="captcha"></div>
        <button type="submit">Sign Up</button>
      </form>
      {error && <p style={{color:'red', marginTop:'10px', textAlign:'center'}}>{error}</p>}
      {alertMessage && <CustomAlert message={alertMessage} onClose={() => setAlertMessage('')} />}
    </>
  )
}
ReactDOM.createRoot(document.getElementById('root')).render(<SignUp />)
</script>
</body>
</html>
